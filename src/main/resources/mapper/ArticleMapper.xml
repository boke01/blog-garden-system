<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zsp.bloggardensystem.mapper.ArticleMapper">
    <select id="articleEntityList" resultType="ArticleEntity">
      select articleID,
        articleTitle,
        a.userID,
        u.userName,
        articleIssueTime,
        articleRead
      from article_table as a left join user_table as u on a.userID = u.userID
      where (a.userID = #{userID} or #{userID} = 0)
      and (u.userName like #{userName} or #{userName} is null)
      and (articleTitle like #{articleTitle} or #{articleTitle} is null)
    </select>

    <update id="addUserRead">
          update user_table
          set userRead = userRead+1
          where userID = #{userID}
    </update>

    <update id="addArticleRead">
          update article_table
          set articleRead = articleRead+ 1
          where articleID = #{articleID}
    </update>

    <select id="getArticle" resultType="ArticleEntity">
        select articleID,
        articleTitle,
        articleCountent,
        pictureCatalog,
        a.userID,
        u.userName,
        articleIssueTime,
        articleRead
      from article_table as a inner join content_tabl as c on a.articleID = c.articleID
      left join user_table as u on a.userID = u.userID
      where a.articleID = #{articleID}
    </select>

    <update id="updateArticle">
        update a,c
        set a.articleTitle = #{articleTitle}, c.articleCountent = #{articleCountent}
        from article_table as a inner join content_tabl as c on a.articleID = c.articleID
        where articleID = #{articleID}
    </update>

    <insert id="addArticle"  useGeneratedKeys="true" keyProperty="articleID">
        insert into article_table(
        articleTitle,
        pictureCatalog,
        userID,
        articleIssueTime)
        values (
        #{articleTitle},
        #{pictureCatalog},
        #{userID},
        now())
    </insert>

    <insert id="addContent">
        insert into content_table(
        articleID,
        articleCountent)
        values (
        #{articleID},
        #{articleCountent})
    </insert>

    <delete id="deleteArticle">
        delete a, c, co
        from article_table as a inner join content_tabl as c on a.articleID = c.articleID left join comment_table as co on a.articleID = co.articleID
        where a.articleID = #{articleID}
    </delete>
</mapper>